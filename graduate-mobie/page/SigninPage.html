<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>签到记录</title>
    <link rel="stylesheet" href="../css/SigninPage.css"/>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>
<table>
    <caption>
            <input  name="Submit" type="button" value="返回" onclick="javascript:history.back(-1);">
        签到记录
    </caption>
    <thead>
    <tr>
        <th>签到时间</th>
        <th>签到地点</th>
    </tr>
    </thead>
    <tbody id="tableBody">

    </tbody>
</table>

<script>
    var pageNum=1;
    var pageSize=15;
    var get_Total=0;

    window.onload = function() {
        console.log("页面加载完成");

        iniData(pageNum,pageSize);
        document.addEventListener("scroll", handleScroll);
    };

    var baseUrl="http://127.0.0.1:8089/api";

    //初始化数据
    function iniData(pageNum,pageSize) {
        // 加载后台数据
        $.ajax({
            url: baseUrl + '/getSignList',
            type: 'get',
            // 设置的是请求参数
            data: {
                "pageSize":pageSize,
                "pageNum":pageNum,
            },
            dataType: 'json',
            success: function (res) {
                console.log(res);
                get_Total=res.total;
                var table = document.getElementById("tableBody")
                var html=table.innerHTML;
                for(var i=0;i<res.rows.length;i++){
                    html+=`  <tr>
                                <th>${res.rows[i].ckTime}</th>
                                <th>${res.rows[i].ckAddress}</th>
                            </tr>`
                }
                table.innerHTML=html;
            }
        });
    }

    function handleScroll(event) {
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        var clientHeight = document.documentElement.clientHeight || document.body.clientHeight;
        var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
        if (scrollTop + clientHeight >= scrollHeight ) {
            pageNum=pageNum+pageSize;
            if ((pageNum)<get_Total){
                iniData(pageNum,pageSize);
            }
        }
    }
</script>
</body>
</html>
