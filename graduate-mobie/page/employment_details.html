<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/employment_details.css">
    <link rel="stylesheet" href="../css/public.css">
    <!-- 引入图标库 -->
    <link rel="stylesheet" href="../lib/iconfont/iconfont.css">
</head>

<body>
<header>
    <span>就业</span>
</header>
<div class="all background">
    <!-- 搜索框 -->
    <div class="searchDiv">
        <input type="text" name="searchEmpName" autocomplete="name" placeholder="搜索职位名称" class="search" id="search-input">
        <button class="searchBtn" onclick="">搜索</button>
    </div>
    <!-- 简介信息 -->
    <div class="infomation">
        <div id="infoContainer"></div>
    </div>

</div>
<!-- 底部导航栏 -->
<div class="toolbar">
    <a href="../page/Signin.html">
        <i class="iconfont icon-index-copy"></i>
        <span>首页</span>
    </a>
    <a href="../page/announcement.html">
        <i class="iconfont icon-youhuiquan"></i>
        <span>通知</span>
    </a>
    <a href="../page/employment_details.html" class="active">
        <i class="iconfont icon-iconfront-"></i>
        <span>就业</span>
    </a>
    <a href="../page/me.html">
        <i class="iconfont icon-7"></i>
        <span>我的</span>
    </a>
</div>
</body>

<script>
    var baseUrl = "http://127.0.0.1:8089/api"

    function getEmpInfo() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", baseUrl + "/selectEmpinfo", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    console.log(xhr.responseText);
                    var response = JSON.parse(xhr.response);

                    var infoContainer = document.getElementById("infoContainer");
                    infoContainer.innerHTML = ""; // 清空原有内容

                    for (var i = 0; i < response.rows.length; i++) {
                        var record = response.rows[i];

                        var empName = record.empName; //empName
                        var empPay = record.empPay; //empPay
                        var empPayMax = record.empPayMax; //empPayMax
                        var cName = record.cName; //cName
                        var cAddress = record.cAddress; //cAddress
                        var empDes = record.empDes; //empDes

                        var div = document.createElement("div");
                        div.className = "infomation_one";
                        div.style.cssText = "display: flex;flex-direction: column;"

                        // 职位与薪资
                        var infomationXinxi = document.createElement("div");
                        infomationXinxi.className = "infomation_xinxi";
                        infomationXinxi.style.cssText = "width: 100%";

                        var workPost = document.createElement("p");
                        workPost.className = "work_post";
                        workPost.style.cssText = "display: inline-block;float: left;margin-left: 2rem;font-size: 1.5rem;";
                        var empNameSpan = document.createElement("div");
                        empNameSpan.textContent = empName;
                        workPost.appendChild(empNameSpan);
                        infomationXinxi.appendChild(workPost);

                        var h1 = document.createElement("h1");
                        h1.style.cssText = "color: #51B9BD; padding-right: 1rem;padding-top: 0.4rem; display: inline-block; float: right; margin-right: 1rem;";
                        var salarySpan = document.createElement("span");
                        salarySpan.textContent = "月薪：";
                        var empPaySpan = document.createElement("span");
                        empPaySpan.id = "empPay";
                        empPaySpan.textContent = empPay;
                        var subSpan = document.createElement("span");
                        subSpan.textContent = "-";
                        var empPayMaxSpan = document.createElement("span");
                        empPayMaxSpan.id = "empPayMax";
                        empPayMaxSpan.textContent = empPayMax;
                        var kSpan = document.createElement("span");
                        kSpan.textContent = "K";
                        h1.appendChild(salarySpan);
                        h1.appendChild(empPaySpan);
                        h1.appendChild(subSpan);
                        h1.appendChild(empPayMaxSpan);
                        h1.appendChild(kSpan);
                        infomationXinxi.appendChild(h1);

                        div.appendChild(infomationXinxi);

                        //职位描述
                        var description = document.createElement("div");
                        description.className = "description";
                        description.style.cssText = "width: 80%;margin 0 auto";

                        var empDesP = document.createElement("p");
                        var empDesSpans = empDes.split(/[，。]/);
                        var length = 0;
                        for (var j = 0; j < 5 && j < empDesSpans.length && length <= 12; j++) {
                            var span = document.createElement("span");
                            span.textContent = empDesSpans[j];
                            length += empDesSpans[j].length;
                            span.style.cssText = "font-size: 0.7rem; color: #616060; padding: 0.3rem; background-color: #f2f2f2; padding: 0.2em 0.5em; border-radius: 10px; margin-right: 5px;";
                            empDesP.appendChild(span);
                        }
                        description.appendChild(empDesP);

                        div.appendChild(description);

                        var companyInfo = document.createElement("div");
                        companyInfo.style.width = "100%";
                        var cNameSpan = document.createElement("div");
                        cNameSpan.style.cssText = "font-size: 0.7rem; display: inline-block; float: left; margin-left: 2.3rem;";
                        cNameSpan.textContent = cName;
                        var cAddressSpan = document.createElement("div");
                        cAddressSpan.style.cssText = "font-size: 0.7rem; padding-right: 1rem; display: inline-block; float: right; margin-right: 1rem;";
                        cAddressSpan.textContent = cAddress;
                        companyInfo.appendChild(cNameSpan);
                        companyInfo.appendChild(cAddressSpan);
                        div.appendChild(companyInfo);

                        infoContainer.appendChild(div);
                    }
                } else {
                    console.log("请求失败，状态码：" + xhr.status);
                }
            }
        };
        xhr.onerror = function () {
            console.log("请求出错");
        };
        xhr.send();
    }

    window.onload = function () {
        getEmpInfo();
    };
</script>

</html>